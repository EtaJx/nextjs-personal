```yaml
title: Go函数(1)
date: 2018-07-10 21:36:54
tags:
- Go
categories:
- Go
```

### 介绍

Go是编译型语言，所以函数编写的顺序是无关紧要的；鉴于可读性的要求，最好的把`main()`函数卸载文件的前面，其他函数按照一定的逻辑顺序进行编写。

Go里面有三种类型的函数：

1. 普通的带有名字的函数
2. 匿名函数或者`lambda`函数
3. 方法（Methods）

**除了main()、init()函数外，其它所有类型的函数都有可以有参数与返回值。函数参数、返回值以及他们的类型都被统称为函数签名。**函数一般是在其它函数里面被调用的，这个其他函数被称为调用函数（calling function）。函数能多次调用其他函数，这些被调用函数按顺序（简单而言）执行，理论上，函数调用其他函数的次数是无穷的（直到函数调用栈被耗尽）。

函函数可以将其他函数调用作为它的参数，只要这个被调用函数的返回值个数、返回值类型和返回值的顺序与调用函数所需求的实参是一致的。例如：

f1需要3个参数`f1(a, b, c int)`，同时f2返回3个参数`f2(a, b int)(int, int, int)`，就可以这样调用f1:`f1(f2(a,b))`。

**Go为什么没有函数重载？**

主要原因是函数重载需要进行多余的类型匹配影响性能；没有重载以为着只是一个简单的函数调度。

如果需要申明一个在外部定义的函数，你只需要给出函数名与函数签名，不需要给出函数体：

```go
func flushICache(begin, end uintptr) // inplemented externally
```

函数也可以以申明的方式呗使用，作为一个函数类型，就像：

```go
type binOp func(int, int) int
```

函数可以进行赋值，`add := binOp`，这个变量知道自己指向的函数的签名，所以给它赋值一个具有不同签名的函数值是不可能的。

### 函数参数与返回值

Go函数可以进行多值返回。

函数定义时，它的形参一般是有名字的，不过我们可以定义没有形参名的函数，只有相应的形参类型，就像`func f(int, int, float64)`。没有参数的函数通场被称为**niladic**函数，就像`main.main()`

#### 按值传递（call by value)和按引用传递（call by reference）

Go默认使用按值传递来传递参数，也就是传递参数的副本，不会影响原来的值。

如果希望函数可以直接修改参数的值，而不是对参数的副本进行操作，你需要将参数的地址（变量名前面添加&符号，比如 &variable）传递给函数，这就是按引用传递，比如 `Function(&arg1)`，此时传递给函数的是一个指针。如果传递给函数的是一个指针，指针的值（一个地址）会被复制，但指针的值所指向的地址上的值不会被复制；我们可以通过这个指针的值来修改这个值所指向的地址上的值。**指针也是变量类型，有自己的地址和值，通常指针的值指向一个变量的地址。所以，按引用传递也是按值传递。**

传递一个指针允许修改直接修改变量的值，消耗也更少。

**尽量使用命名返回值：会使代码更清晰、更简短，同时更加容易读懂。**

#### 空白符(black identifier)

空白符用来匹配人一些不需要的值，然后丢弃掉：

```go
pacakge main

import "fmt"

func main() {
  var i1 int
  var f1 float32
  i1, _, f1 = ThreeValues()
  fmt.Printf("The int: %d, the float: %f \n", i1, f1)
}

func ThreeValues() (int, int, float32) {
  return 5, 6, 7.5
}
```

#### 改变外部变量

传递指针给函数，在节省内存的同时，还赋予了函数直接修改外部变量的能力，所以被修改的变量不再需要使用`return`返回。

```go
package main

import "fmt"

func main() {
  n := 0
  reply := &n
  Multiply(10, 5, reply)
  fmt.Printf("Multiply:", *reply)
}

func Multiply(a ,b int, reply *int)) {
  *reply = a * b
}
```

### 传递变长参数

如果函数的最后一个参数采用`...type`的形式，那么这个函数就可以处理一个变长的参数，这个长度可以为0，这样的函数称为变参函数。

```go
func myFunc(a, b, arg, ...int) {}
```

